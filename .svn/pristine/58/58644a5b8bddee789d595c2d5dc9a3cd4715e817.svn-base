<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec"%>
<sec:authentication property="principal.employee" var="empVO" />
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script src="/resources/js/jquery-3.6.0.js"></script>
<title>Insert title here</title>
<style>
.card {
	width: 70vw;
	height:79vh;
	margin: 27px 0px 0px 265px;
}
#orderHeader {
	display:flex;
	width:81.6vw;
	margin:0px 0px 25px 0px;
}
.card-header {
	margin: 17px 0px 0px 5px;
	font-weight:bolder;
}
#orderBtn {
    width: 4vw;
    height: 4vh;
    margin-top: 35px;
}
.table-hover {
    margin-left: 18px;
    width: 68vw;
}
.text-nowrap {
	height: 57vh;
}
#rejectBtn {
	width: 4vw;
    height: 4vh;
    padding: 3px 0px 0px 0px!important;
    margin: 14px 0px -2px 1245px;
}
a, a:active {
	color: inherit;
	text-decoration: none;
}
#myTable {
	overflow: auto;
}
</style>
</head>
<body>
	<div class="card">
		<div id="wrapper">
			<div id="orderHeader">
				<div>
					<div style="display:flex;">
						<h4 class="card-header">ë¹„í’ˆ ì‹ ì²­ ì¡°íšŒ</h4>
						<button class="btn btn-primary" type="button" id="orderBtn">ë°œì£¼</button>
					</div>
					<p style="margin:8px 0px -10px 25px;"></p>
				</div>
			</div><!-- notice header ë -->
			
			<!-- í…Œì´ë¸” ì²˜ë¦¬ -->
			<div class="table-responsive text-nowrap">
				<div id="myTable"></div>
			</div><!-- table div ë -->
			
			<button type="button" class="btn btn-secondary" id="rejectBtn">ë°˜ë ¤</button>
			
		</div><!-- wrapper ë -->
	</div><!-- card ë -->
</body>
<script>
//-------------------- ì›¹ì†Œì¼“ ----------------------
function fMessage() { // ë°›ëŠ” ìª½ì— ì‘ì„±
	let serverMsg = JSON.parse(event.data);

	if(serverMsg.cmd == "alarm") {
		getNotiList();
	}
}
//-------------------- /ì›¹ì†Œì¼“ ----------------------

$(function(){
	getEquipItemList();
});

// ì•½í’ˆ ì‹ ì²­ ì¡°íšŒ ë¦¬ìŠ¤íŠ¸ ë¿Œë¦¬ê¸°
const getEquipItemList = () => {
	console.log("ì—¬ê¸°ëŠ” getEquipItemList");
	let xhr = new XMLHttpRequest();
	xhr.open("get", "/order/equipList", true);
	xhr.onreadystatechange = function() {
		if(xhr.readyState == 4 && xhr.status == 200) {
			let result = JSON.parse(xhr.responseText);
			console.log("ë°›ì•„ì˜¨ ë¹„í’ˆ ì‹ ì²­ ì¡°íšŒ ë¦¬ìŠ¤íŠ¸", result);

			$('#orderHeader p').text("ğŸ”” ì´ " + result.length + "ê°œì˜ ë¹„í’ˆì‹ ì²­ë‚´ì—­ì´ ìˆìŠµë‹ˆë‹¤.");
			
			let tblStr = `<table class="table table-hover">`;
			tblStr += `<thead><tr>`;
			tblStr += `<th>ë°˜ë ¤ì²´í¬</th>`;
			tblStr += `<th>ë¹„í’ˆì½”ë“œ</th>`;
			tblStr += `<th>ë¹„í’ˆëª…</th>`;
			tblStr += `<th>ê±°ë˜ì²˜</th>`;
			tblStr += `<th>ê¸ˆì•¡</th>`;
			tblStr += `<th>ì‹ ì²­ìˆ˜ëŸ‰</th>`;
			tblStr += `<th>ì‹ ì²­ì¼ì</th>`;
			tblStr += `<th>ì‹ ì²­ì¸</th>`
			tblStr += `</tr></thead>`;
			tblStr += `<tbody>`;
			for(let i=0; i<result.length; i++) {
				tblStr += `<tr>`;
				tblStr += `<td><input class="form-check-input" type="checkbox" id="defaultCheck3"></td>`;
				tblStr += `<td>\${result[i].itemCode}</td>`;
				tblStr += `<td>\${result[i].itemName}</td>`;
				tblStr += `<td>\${result[i].itemMakr}</td>`;
				tblStr += `<td>\${result[i].itemPrice}</td>`;
				tblStr += `<td>\${result[i].itemReqQy}</td>`;
				tblStr += `<td>\${result[i].itemReqDe}</td>`;
				tblStr += `<td>\${result[i].empNm}</td>`;
				tblStr += `</tr>`;
			}
			tblStr += `</tbody></table>`;
			
// 			console.log("tblStr" + tblStr);
			$('#myTable').html(tblStr);
		} 
	}
	xhr.send();
}

//ë°˜ë ¤ë²„íŠ¼ í´ë¦­ ì‹œ ì²´í¬í•œ ê°’ë“¤ ë°°ì—´ì— ë‹´ê¸°
$('#rejectBtn').on('click', function() {
// 	console.log("ë°˜ë ¤ë²„íŠ¼ í´ë¦­");
    let selectChkBoxes= $("input[name='chkArr[]']:checked");
//     console.log("ì„ íƒëœ ì²´í¬ë°•ìŠ¤: ", selectChkBoxes);
    
    // ë¹„í’ˆì½”ë“œê°€ ì €ì¥ë  ë°°ì—´
    var chkArr = [];
    selectChkBoxes.each(function() {
        chkArr.push($(this).closest('tr').find('td:eq(1)').text()); // 1ë²ˆì§¸ tdì¸ ë¹„í’ˆì½”ë“œ push
    });
    
    if(chkArr.length == 0 || chkArr == null) {
    	Swal.fire({
    		icon: 'error',
    		text: 'ë°˜ë ¤í•  ë¹„í’ˆì´ ì—†ìŠµë‹ˆë‹¤.'
   		});
    } else {
	    confirm("ì„ íƒí•œ ë¹„í’ˆì½”ë“œ: " + chkArr + "\në¹„í’ˆì„ ë°˜ë ¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
    }
});

</script>
</html>